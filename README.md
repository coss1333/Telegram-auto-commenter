# Telegram Auto Commenter (1–2 comments/day)

Этот проект публикует **1–2 комментария в день** в указанной группе Telegram, поддерживая тему беседы с учётом **последних 10 сообщений**.

## Возможности
- Читает последние 10 сообщений группы и формирует короткий, ненавязчивый ответ.
- Публикует 1–2 комментария/день в случайное время в заданном окне.
- Отвечает «реплаем» на самое свежее релевантное сообщение, чтобы поддержать нитку обсуждения.
- Работает как **юзер-бот** на базе **Telethon** (читает историю и пишет от имени вашего аккаунта).
- Лёгкая настройка через `.env`.
- Есть Docker-вариант.

> **Важно:** уважайте правила группы и антиспам. Настройте окно публикаций и частоту разумно.

## Быстрый старт (без Docker)
1) Установите Python 3.10+ и зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2) Получите `api_id` и `api_hash` на https://my.telegram.org/apps

3) Сгенерируйте `SESSION_STRING` (одноразовый вход):
   ```bash
   python gen_session.py
   ```
   Следуйте инструкциям в консоли, после чего скрипт выведет длинную строку — скопируйте её в `.env`.

4) Скопируйте `.env.sample` в `.env` и заполните:
   ```bash
   cp .env.sample .env
   # отредактируйте .env, укажите TARGET_CHAT и SESSION_STRING
   ```

5) Запуск локально:
   ```bash
   python bot_commenter.py
   ```

## Запуск в Docker
```bash
docker build -t telegram-auto-commenter .
# Первый запуск без SESSION_STRING создаст его в логах контейнера, но удобнее сначала сгенерировать локально (gen_session.py) и положить в .env
docker run --env-file .env --name tg-auto-commenter --restart unless-stopped -d telegram-auto-commenter
```

## Переменные окружения (.env)
- `API_ID` — ваш api_id из https://my.telegram.org/apps
- `API_HASH` — ваш api_hash
- `SESSION_STRING` — строковая сессия Telethon (получите через `gen_session.py`)
- `TARGET_CHAT` — @username группы, публичная ссылка или числовой id (например, -100xxxxxxxxxx)
- `TZ` — часовой пояс контейнера/скрипта (по умолчанию Europe/Riga)
- `POST_WINDOW_START` — начало окна постинга (час 0–23), по умолчанию 9
- `POST_WINDOW_END` — конец окна (час 0–23), по умолчанию 21
- `MIN_COMMENTS_PER_DAY` — минимум комментариев в день (по умолчанию 1)
- `MAX_COMMENTS_PER_DAY` — максимум комментариев в день (по умолчанию 2)
- `LANG` — язык шаблонов ответа (`ru`/`en`), по умолчанию `ru`

## Как это работает
- По расписанию (**APScheduler**) выбирается случайное количество комментариев на сегодня (1 или 2).
- Перед каждым комментарием скрипт:
  1. Загружает 10 последних сообщений.
  2. Выбирает ключевые слова (простая эвристика + стоп-слова).
  3. Собирает нейтральный «поддерживающий» ответ по шаблонам.
  4. Отвечает реплаем на последнее подходящее сообщение.
- Скрипт ведёт локальное состояние `state.json`, чтобы не превышать дневной лимит.

## Советы
- Начните с закрытого тест-чата, проверьте формулировки.
- При необходимости отредактируйте шаблоны в `templates.py`.
- Если группа использует **Темы (Topics)** — скрипт ответит в теме последнего сообщения (если возможно).

## Безопасность
- Никому не передавайте ваш `SESSION_STRING`.
- Включите 2FA в Telegram.
- Уважайте правила группы, не злоупотребляйте автоматическими комментариями.
